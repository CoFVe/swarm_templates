version: '3.9'
services:
  plex:
    image: plexinc/pms-docker:1.41.4.9463-630c9f557
    environment:
      - PLEX_CLAIM=claim-QwNjGyMuHuyRut2pd9oZ
      - VERSION=docker
      - ADVERTISE_IP="http://172.25.25.5:32400"
    volumes:
      - /mnt/moosefs/apps/Plex:/config
      - /mnt/moosefs/series/shows:/tv_shows
      - /mnt/moosefs/movies/peliculas:/peliculas
      - /mnt/moosefs/movies/3d:/3d_movies
      - /mnt/moosefs/movies/infantiles:/peliculas_infantiles
      - /mnt/moosefs/series/infantiles:/series_infantiles
      - /mnt/moosefs/movies/anime:/movies_anime
      - /mnt/moosefs/series/anime:/series_anime
      - /mnt/moosefs/series/ecchi:/series_ecchi
      - /mnt/moosefs/music:/music
      - /mnt/moosefs/movies/comic:/peliculas_comic
      - /mnt/moosefs/movies/ecchi:/movies_ecchi
      - dri:/dev/dri
    hostname: odroidxu4
    deploy:
      replicas: 1
      labels:
        - traefik.enable=true
        - traefik.docker.network=outside
        - traefik.http.routers.plex.entrypoints=web
        - traefik.http.routers.plex.rule=Host(plex.cofhome)
        - traefik.http.routers.plex.service=plex
        - traefik.http.services.plex.loadbalancer.server.port=32400
        - traefik.port=80
      placement:
        constraints:
          - node.labels.nuc==true
        preferences:
          - spread: node.labels.nuc
    restart: always
    networks:
      - outside

networks:
  outside:
    external:
      name: "host"
volumes:
  dri:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /dev/dri
